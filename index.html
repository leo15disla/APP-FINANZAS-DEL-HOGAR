<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- PWA primary color matching the purple iOS aesthetic -->
  <meta name="theme-color" content="#7D5BA6" />
  <title>Finanzas del Hogar</title>
  <!-- Manifest for PWA installation -->
  <link rel="manifest" href="./manifest.json" />
  <!-- Application styles: cargamos primero la versi√≥n minificada y luego la versi√≥n completa
         para que las nuevas clases de sobres se apliquen correctamente. -->
  <link rel="stylesheet" href="./style.min.css" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- Fixed navigation bar -->
  <header class="navbar" id="navbar" style="display:none;">
    <!-- Encabezado m√≥vil con men√∫ hamburguesa y t√≠tulo -->
    <div id="mobile-header">
      <button id="btn-menu-mobile">‚ò∞</button>
      <span id="mobile-title">Finanzas del Hogar</span>
    </div>
    <div class="nav-container">
      <a href="#" class="nav-brand">Finanzas del Hogar</a>
      <!-- Men√∫ de escritorio -->
      <nav class="nav-links desktop-menu">
        <!-- Each link contains a data-view attribute which corresponds
               to the id of the section it controls.  The SPA router in
               app.js will toggle visibility on click. -->
        <a href="#" class="nav-item active" data-view="dashboard">Dashboard</a>
        <a href="#" class="nav-item" data-view="registrar">Registrar</a>
        <a href="#" class="nav-item" data-view="movimientos">Movimientos</a>
        <a href="#" class="nav-item" data-view="cuentas">Cuentas</a>
        <a href="#" class="nav-item" data-view="prestamos">Pr√©stamos</a>
        <a href="#" class="nav-item" data-view="calendario">Calendario</a>
        <a href="#" class="nav-item" data-view="presupuesto">Presupuesto</a>
        <a href="#" class="nav-item" data-view="exportar">Exportar</a>
        <a href="#" class="nav-item" data-view="ajustes">Ajustes</a>
      </nav>
    </div>
    <!-- Men√∫ m√≥vil desplegable -->
    <nav id="mobile-menu" class="hidden">
      <ul>
        <li data-view="dashboard">Dashboard</li>
        <li data-view="registrar">Registrar</li>
        <li data-view="movimientos">Movimientos</li>
        <li data-view="cuentas">Cuentas</li>
        <li data-view="prestamos">Pr√©stamos</li>
        <li data-view="calendario">Calendario</li>
        <li data-view="presupuesto">Presupuesto</li>
        <li data-view="exportar">Exportar</li>
        <li data-view="ajustes">Ajustes</li>
      </ul>
    </nav>
  </header>

  <!-- Main application container.  Each section represents a view in our
         single‚Äëpage app.  Only the section with the class `active` is
         displayed at any given time. -->
  <main id="app" class="app-container">
    <!-- Dashboard view -->
    <section id="dashboard" class="view">
      <!-- Tarjeta principal del dashboard -->
      <div class="hero-card">
        <div class="hero-icon">
          <!-- Icono de casa blanco como SVG para mejor control de color -->
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z" fill="#FFFFFF" />
          </svg>
        </div>
        <div class="hero-text">
          <h2>Finanzas del Hogar</h2>
          <p>Tu resumen financiero</p>
        </div>
      </div>
      <!-- Resumen del mes -->
      <div class="dashboard-grid">
        <div class="summary-card-new" id="income-summary">
          <h3>Ingresos</h3>
          <p class="summary-value" id="income-summary-value">$0.00</p>
        </div>
        <div class="summary-card-new" id="expense-summary">
          <h3>Gastos</h3>
          <p class="summary-value" id="expense-summary-value">$0.00</p>
        </div>
        <div class="summary-card-new" id="balance-summary">
          <h3>Balance</h3>
          <p class="summary-value" id="balance-summary-value">$0.00</p>
        </div>
        <div class="summary-card-new" id="difference-summary">
          <h3>Diferencia vs mes anterior</h3>
          <p class="summary-value" id="difference-summary-value">‚Äì</p>
        </div>
      </div>
      <!-- M√©tricas Reales de Presupuesto -->
      <div class="card budget-health-card">
        <h3>Salud del Presupuesto</h3>
        <div class="budget-metrics-grid">
          <div class="budget-metric">
            <span class="metric-label">Fondos en Sobres</span>
            <span class="metric-value" id="total-envelopes-balance">---</span>
          </div>
          <div class="budget-metric">
            <span class="metric-label">Flujo Mensual</span>
            <span class="metric-value" id="monthly-flow-value">---</span>
          </div>
          <div class="budget-metric">
            <span class="metric-label">Sobres en Riesgo</span>
            <span class="metric-value warning" id="envelopes-risk-count">0</span>
          </div>
          <div class="budget-metric">
            <span class="metric-label">Sobres Excedidos</span>
            <span class="metric-value danger" id="envelopes-danger-count">0</span>
          </div>
        </div>
      </div>
      <!-- Gr√°fico simple de Ingresos vs Gastos -->
      <div class="chart-card card">
        <h3>Ingresos vs Gastos</h3>
        <div id="bar-chart" class="bar-chart"></div>
      </div>
      <!-- Secci√≥n de cuentas bancarias -->
      <div class="accounts-card card">
        <h3>Cuentas bancarias</h3>
        <div class="accounts-summary">
          <div class="account-metric">
            <h4>Total en cuentas</h4>
            <p id="accounts-total">$0.00</p>
          </div>
          <div class="account-metric">
            <h4>Liquidez</h4>
            <p id="accounts-liquid">$0.00</p>
          </div>
          <div class="account-metric">
            <h4>Deudas del mes</h4>
            <p id="accounts-debt">$0.00</p>
          </div>
        </div>
        <div class="wallet-placeholder">
          <div class="wallet-card-placeholder">Tarjeta de cr√©dito<br />Balance: $0.00</div>
          <div class="wallet-card-placeholder">Cuenta de ahorros<br />Balance: $0.00</div>
        </div>
      </div>
    </section>

    <!-- Registrar view: formulario moderno para registrar un movimiento -->
    <section id="registrar" class="view">
      <div class="form-card">
        <h2>Registrar movimiento</h2>
        <!-- Formulario -->
        <form id="movimiento-form" class="movement-form">
          <!-- Tipo de movimiento -->
          <div class="form-group">
            <label for="mov-tipo">Tipo de movimiento</label>
            <select id="mov-tipo" required>
              <option value="ingreso">Ingreso</option>
              <option value="gasto">Gasto</option>
            </select>
          </div>
          <!-- Monto -->
          <div class="form-group">
            <label for="mov-monto">Monto</label>
            <input type="number" id="mov-monto" min="0" step="0.01" placeholder="0.00" required />
          </div>
          <!-- Sobre (solo visible en gastos) -->
          <div class="form-group" id="grupo-sobre" style="display:none;">
            <label for="mov-sobre">Sobre</label>
            <select id="mov-sobre">
              <!-- opciones cargadas din√°micamente -->
            </select>
          </div>
          <!-- Fecha oculta: la fecha se asigna autom√°ticamente en JS -->
          <input type="hidden" id="mov-fecha" />
          <!-- Nota -->
          <div class="form-group">
            <label for="mov-nota">Nota</label>
            <textarea id="mov-nota" rows="3" placeholder="A√±ade una nota (opcional)"></textarea>
          </div>
          <!-- Bot√≥n -->
          <div class="form-group">
            <button type="submit" class="btn btn-primary">Guardar movimiento</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Movimientos view: listado completo con filtros avanzados -->
    <section id="movimientos" class="view">
      <div class="movimientos-header">
        <h2>Movimientos</h2>
        <div class="movimientos-actions">
          <div class="search-bar">
            <input type="text" id="mov-search" placeholder="Buscar..." />
            <span class="search-icon">üîç</span>
          </div>
          <div class="filters-advanced">
            <div class="filter-group">
              <label for="mov-filter-type">Tipo</label>
              <select id="mov-filter-type">
                <option value="todos">Todos</option>
                <option value="ingreso">Ingresos</option>
                <option value="gasto">Gastos</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="mov-filter-range">Rango</label>
              <select id="mov-filter-range">
                <option value="todos">Todos</option>
                <option value="hoy">Hoy</option>
                <option value="semana">Semana</option>
                <option value="mes">Mes</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="mov-filter-category">Categor√≠a</label>
              <select id="mov-filter-category">
                <option value="todas">Todas</option>
                <!-- Categor√≠as din√°micas -->
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="movimientos-history">
        <button id="btn-mes-actual" class="btn-secondary">Mes actual</button>
        <button id="btn-historial" class="btn-secondary">Historial mensual</button>
      </div>
      <div class="movimientos-summary">
        <div class="summary-box ingreso">
          <span>Ingresos</span>
          <p id="mov-ingresos-total">US$0.00</p>
        </div>
        <div class="summary-box gasto">
          <span>Gastos</span>
          <p id="mov-gastos-total">US$0.00</p>
        </div>
        <div class="summary-box balance">
          <span>Balance</span>
          <p id="mov-balance-total">US$0.00</p>
        </div>
      </div>
      <div class="movimientos-list" id="movimientos-list">
        <!-- Tarjetas de movimientos -->
      </div>
    </section>

    <!-- Cuentas view: estilo Apple Wallet con lista y formulario -->
    <section id="cuentas" class="view">
      <div class="cuentas-header">
        <h2>Cuentas</h2>
        <div class="cuentas-summary">
          <div class="summary-box total">
            <span>Total en cuentas</span>
            <p id="cuentas-total-saldo">US$0.00</p>
          </div>
          <div class="summary-box liquidez">
            <span>Liquidez</span>
            <p id="cuentas-liquidez">US$0.00</p>
          </div>
          <div class="summary-box deuda">
            <span>Deudas del mes</span>
            <p id="cuentas-deuda">US$0.00</p>
          </div>
        </div>
      </div>
      <div class="cuentas-stack" id="cuentas-list">
        <!-- Tarjetas de cuentas -->
      </div>
      <div class="cuenta-form-card">
        <h3 id="cuenta-form-title">Agregar cuenta</h3>
        <form id="cuenta-form">
          <div class="form-group">
            <label for="cuenta-nombre">Nombre de cuenta</label>
            <input type="text" id="cuenta-nombre" required />
          </div>
          <div class="form-group">
            <label for="cuenta-tipo">Tipo de cuenta</label>
            <select id="cuenta-tipo" required>
              <option value="">Seleccionar tipo</option>
              <option value="bancaria">Bancaria</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="efectivo">Efectivo</option>
              <option value="otras">Otras</option>
            </select>
          </div>
          <div class="form-group">
            <label for="cuenta-saldo">Saldo</label>
            <input type="number" id="cuenta-saldo" step="0.01" required />
          </div>
          <div class="form-group">
            <label for="cuenta-nota">Nota</label>
            <textarea id="cuenta-nota" rows="2" placeholder="Opcional"></textarea>
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-primary">Guardar cuenta</button>
          </div>
        </form>
      </div>
    </section>

    <!-- Pr√©stamos view -->
    <!-- =================== M√≥dulo Pr√©stamos =================== -->
    <section id="prestamos" class="view">
      <div class="prestamos-header">
        <h2>Pr√©stamos</h2>
        <button id="btn-nuevo-prestamo" class="btn btn-primary">Nuevo pr√©stamo</button>
      </div>
      <!-- Formulario para registrar o editar un pr√©stamo -->
      <div id="prestamo-form-container" class="prestamo-form-card hidden">
        <h3 id="prestamo-form-title">Registrar pr√©stamo</h3>
        <form id="prestamo-form" class="loan-form">
          <div class="form-group">
            <label for="prestamo-nombre">Nombre del pr√©stamo</label>
            <input type="text" id="prestamo-nombre" required />
          </div>
          <div class="form-group">
            <label for="prestamo-tipo">Tipo de pr√©stamo</label>
            <select id="prestamo-tipo" required>
              <option value="francesa">Francesa</option>
              <option value="americana">Americana</option>
              <option value="compuesto">Inter√©s compuesto diario</option>
            </select>
          </div>
          <div class="form-group">
            <label for="prestamo-monto">Monto</label>
            <input type="number" id="prestamo-monto" step="0.01" min="0" required />
          </div>
          <div class="form-group">
            <label for="prestamo-tasa">Tasa anual (%)</label>
            <input type="number" id="prestamo-tasa" step="0.01" min="0" required />
          </div>
          <div class="form-group">
            <label for="prestamo-plazo">Plazo (meses)</label>
            <input type="number" id="prestamo-plazo" min="1" required />
          </div>
          <div class="form-group">
            <label for="prestamo-fecha-inicio">Fecha de inicio</label>
            <input type="date" id="prestamo-fecha-inicio" required />
          </div>
          <div class="form-group">
            <label for="prestamo-fecha-primer-pago">Fecha del primer pago</label>
            <input type="date" id="prestamo-fecha-primer-pago" required />
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-primary">Guardar pr√©stamo</button>
          </div>
        </form>
      </div>
      <!-- Lista de pr√©stamos activos -->
      <div id="prestamos-list" class="prestamos-list">
        <!-- Tarjetas de pr√©stamos se insertan con JS -->
      </div>
      <!-- Detalle del pr√©stamo seleccionado -->
      <div id="prestamo-detalle-container" class="prestamo-detalle hidden">
        <!-- Secci√≥n para mostrar detalle y cronograma -->
      </div>
    </section>

    <!-- =================== M√≥dulo Calendario =================== -->
    <section id="calendario" class="view">
      <!-- Tabs para cambiar entre calendario y agenda -->
      <div class="calendario-tabs">
        <button id="btn-vista-calendario" class="tab-activa">Calendario</button>
        <button id="btn-vista-agenda">Agenda del Mes</button>
      </div>
      <!-- Vista del calendario -->
      <div id="vista-calendario">
        <div class="calendar-header">
          <button id="cal-prev" class="btn-nav" aria-label="Mes anterior">&#x276E;</button>
          <h2 id="calendar-title">Calendario</h2>
          <button id="cal-next" class="btn-nav" aria-label="Mes siguiente">&#x276F;</button>
        </div>
        <div class="calendar-grid" id="calendar-grid">
          <!-- Celdas del calendario -->
        </div>
        <div id="calendar-details" class="calendar-details hidden">
          <!-- Detalles del d√≠a seleccionado -->
        </div>
      </div>
      <!-- Vista de agenda financiera del mes (renombrada) -->
      <div id="vista-agenda-mes" style="display:none;">
        <h2>Agenda Financiera del Mes</h2>
        <div class="agenda-resumen">
          <p><strong>Total a pagar este mes:</strong> <span id="agenda-total"></span></p>
          <p><strong>Total pagado:</strong> <span id="agenda-pagado"></span></p>
          <p><strong>Total pendiente:</strong> <span id="agenda-pendiente"></span></p>
        </div>
        <div id="agenda-list" class="agenda-list"></div>
      </div>
    </section>

    <!-- =================== M√≥dulo Presupuesto =================== -->
    <section id="presupuesto" class="view">
      <!-- Nueva vista de presupuesto basada en sobres -->
      <div class="sobres-header">
        <h2>Presupuesto / Sobres</h2>
        <div class="sobres-header-actions">
          <button id="btn-nuevo-sobre" class="btn btn-primary">Nuevo sobre</button>
          <button id="btn-ir-cierre-mensual" class="btn btn-secondary">Cerrar mes (sobres)</button>
        </div>
      </div>
      <!-- Resumen general de sobres -->
      <div id="sobres-resumen" class="sobres-resumen"></div>
      <!-- Lista de sobres -->
      <div id="sobres-list" class="sobres-list"></div>

      <!-- Reporte de distribuci√≥n de ingresos entre sobres -->
      <div id="reporte-distribucion"></div>
      <!-- Formulario para crear o editar sobres -->
      <div id="sobre-form-container" class="sobres-form-card hidden">
        <h3 id="sobre-form-title">Nuevo sobre</h3>
        <form id="sobre-form" class="sobres-form">
          <div class="form-group">
            <label for="sobre-nombre">Nombre del sobre</label>
            <input type="text" id="sobre-nombre" required />
          </div>
          <div class="form-group">
            <label for="sobre-tipo">Tipo</label>
            <select id="sobre-tipo" required>
              <option value="fijo">Fijo</option>
              <option value="variable">Variable</option>
            </select>
          </div>
          <div class="form-group" id="sobre-limite-group">
            <label for="sobre-limite">L√≠mite (solo fijos)</label>
            <input type="number" id="sobre-limite" step="0.01" min="0" />
          </div>
          <div class="form-group">
            <label for="sobre-prioridad">Prioridad</label>
            <select id="sobre-prioridad">
              <option value="alta">Alta (primero)</option>
              <option value="media">Media</option>
              <option value="baja">Baja (√∫ltimo)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sobre-categoria-distribucion">Tipo de distribuci√≥n</label>
            <select id="sobre-categoria-distribucion">
              <option value="necesidad">Necesidad</option>
              <option value="deseo">Deseo</option>
              <option value="ahorro">Ahorro</option>
            </select>
          </div>
          <div class="form-group" id="grupo-dia-pago" style="display:none;">
            <label for="sobre-dia-pago">D√≠a de pago</label>
            <input id="sobre-dia-pago" type="number" min="1" max="31" placeholder="Ej: 15" />
            <small>Es el d√≠a del mes en que normalmente pagas este gasto fijo.</small>
          </div>
          <div class="form-group">
            <label for="sobre-categoria">Categor√≠a vinculada</label>
            <select id="sobre-categoria">
              <option value="">Sin categor√≠a</option>
              <option value="Comida">Comida</option>
              <option value="Transporte">Transporte</option>
              <option value="Salud">Salud</option>
              <option value="Entretenimiento">Entretenimiento</option>
              <option value="Otros">Otros</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sobre-metodo">M√©todo de distribuci√≥n</label>
            <select id="sobre-metodo">
              <option value="prioridad">Por prioridad</option>
              <option value="equitativa">Equitativa</option>
              <option value="proporcional">Proporcional al l√≠mite</option>
            </select>
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-primary">Guardar sobre</button>
          </div>
        </form>
      </div>
    </section>

    <!-- =================== M√≥dulo Exportar =================== -->
    <section id="exportar" class="view">
      <h2>Exportar datos</h2>
      <div class="export-section">
        <h3>Selecciona el tipo de datos</h3>
        <div class="export-options">
          <label><input type="checkbox" id="export-movimientos" checked /> Movimientos</label>
          <label><input type="checkbox" id="export-cuentas" checked /> Cuentas</label>
          <label><input type="checkbox" id="export-prestamos" checked /> Pr√©stamos</label>
          <label><input type="checkbox" id="export-sobres" checked /> Presupuesto/Sobres</label>
        </div>
        <h3>Formato</h3>
        <div class="export-format">
          <select id="export-format">
            <option value="json">JSON</option>
            <option value="csv">CSV</option>
            <option value="txt">TXT</option>
          </select>
          <button id="btn-exportar" class="btn btn-primary">Exportar</button>
        </div>
      </div>
      <div class="export-pdf-section">
        <h3>Informe en PDF</h3>
        <button id="btn-exportar-pdf" class="btn btn-primary">Generar PDF</button>
      </div>
    </section>

    <!-- =================== Cierre Mensual de Sobres =================== -->
    <section id="vista-cierre-mensual" class="view hidden">
      <h2>Cierre mensual de sobres</h2>
      <p>Compara el dinero f√≠sico con el saldo de la app para cada sobre.</p>
      <div id="cierre-sobres-list" class="cierre-sobres-list"></div>
      <div class="cierre-acciones">
        <button id="btn-cancelar-cierre" type="button">Cancelar</button>
        <button id="btn-confirmar-cierre" type="button" class="btn btn-primary">Confirmar cierre del mes</button>
      </div>
      <div id="cierre-resumen" class="cierre-resumen"></div>
    </section>


    <!-- =================== M√≥dulo Ajustes =================== -->
    <section id="ajustes" class="view">
      <h2>Ajustes</h2>
      <form id="ajustes-form" class="settings-form">
        <div class="form-group">
          <label for="user-name">Nombre de usuario</label>
          <input type="text" id="user-name" />
        </div>
        <div class="form-group">
          <label for="user-currency">Moneda preferida</label>
          <select id="user-currency">
            <option value="USD">USD</option>
            <option value="DOP">DOP</option>
            <option value="EUR">EUR</option>
          </select>
        </div>
        <div class="form-group">
          <label for="font-size-select">Tama√±o de fuente</label>
          <select id="font-size-select">
            <option value="med">Mediana</option>
            <option value="small">Peque√±a</option>
            <option value="large">Grande</option>
          </select>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="dark-mode-toggle" /> Modo oscuro</label>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="contrast-toggle" /> Alto contraste</label>
        </div>
        <div class="form-group">
          <label><input type="checkbox" id="animations-toggle" checked /> Habilitar animaciones</label>
        </div>
        <div class="form-group">
          <button id="btn-guardar-ajustes" type="button" class="btn btn-primary">Guardar ajustes</button>
        </div>
        <div class="form-group">
          <button id="btn-export-backup" type="button" class="btn btn-secondary">Exportar backup</button>
          <input type="file" id="import-backup-input" accept="application/json" style="display:none;" />
          <button id="btn-import-backup" type="button" class="btn btn-secondary">Importar backup</button>
        </div>
        <div class="form-group">
          <button id="btn-optimize-app" type="button" class="btn btn-secondary">Optimizar App</button>
        </div>
        <div class="form-group">
          <button id="btn-reset-data" type="button" class="btn btn-danger">Restaurar todos los datos</button>
        </div>
        <p class="version-info">Versi√≥n: 1.0.0</p>
      </form>
    </section>

    <!-- =================== Vista Detalle Sobre =================== -->
    <!-- Esta vista muestra informaci√≥n detallada de un sobre seleccionado. -->
    <section id="vista-sobre-detalle" class="view">
      <!-- El contenido se generar√° din√°micamente mediante JS -->
    </section>

    <!-- =================== Vista de Cierre Mensual (placeholder) =================== -->
    <!-- Esta secci√≥n se mantuvo aqu√≠ por compatibilidad, pero ya no se usa.
           El contenido real del cierre mensual se define en la secci√≥n anterior
           con id="vista-cierre-mensual" y se controla via JS.  Esta secci√≥n
           permanece sin funcionalidad para evitar IDs duplicados. -->
    <section id="vista-cierre-mensual-legacy" class="hidden"></section>
  </main>

  <!-- =================== ONBOARDING VIEWS (UX FASE A) =================== -->

  <!-- A) Splash -->
  <section id="view-splash" class="view active">
    <div class="card onboarding-card center">
      <div class="spinner" aria-label="Cargando"></div>
      <p class="muted">Verificando acceso‚Ä¶</p>
    </div>
  </section>

  <!-- B) Welcome -->
  <section id="view-welcome" class="view hidden">
    <div class="card onboarding-card">
      <h1>Bienvenido a Finanzas del Hogar</h1>
      <p class="muted">Control claro y premium para tu hogar.</p>

      <label class="field">
        <span>N√∫mero de tel√©fono</span>
        <input id="auth-phone" inputmode="tel" autocomplete="tel" placeholder="+1 809‚Ä¶" />
      </label>

      <button id="btn-welcome-continue" class="btn btn-primary" style="width:100%; margin-top:1rem;">Continuar</button>
      <p class="tiny muted" style="margin-top:0.5rem;">Usaremos SMS solo para crear tu cuenta o recuperar acceso.</p>
    </div>
  </section>

  <!-- C) SMS -->
  <section id="view-sms" class="view hidden">
    <div class="card onboarding-card">
      <h1>Verifica tu n√∫mero</h1>
      <p class="muted">Te enviamos un c√≥digo por SMS.</p>

      <label class="field">
        <span>C√≥digo (6 d√≠gitos)</span>
        <input id="auth-otp" inputmode="numeric" autocomplete="one-time-code" maxlength="6" placeholder="123456" />
      </label>

      <div class="row" style="margin-top:1rem;">
        <button id="btn-sms-back" class="btn btn-secondary">Atr√°s</button>
        <button id="btn-sms-verify" class="btn btn-primary">Verificar</button>
      </div>

      <p id="sms-hint" class="tiny muted" style="margin-top:0.5rem;"></p>
    </div>
  </section>

  <!-- D) Setup Home -->
  <section id="view-setup-home" class="view hidden">
    <div class="card onboarding-card">
      <h1>Configura tu hogar</h1>

      <label class="field">
        <span>Nombre del hogar</span>
        <input id="home-name" placeholder="Hogar Leo & Maddy" />
      </label>

      <label class="field" style="margin-top:1rem;">
        <span>Moneda</span>
        <select id="home-currency">
          <option value="DOP" selected>RD$ (DOP)</option>
          <option value="USD">US$ (USD)</option>
        </select>
      </label>

      <button id="btn-home-create" class="btn btn-primary" style="width:100%; margin-top:1.5rem;">Continuar</button>
    </div>
  </section>

  <!-- E) Access Method -->
  <section id="view-access-method" class="view hidden">
    <div class="card onboarding-card">
      <h1>¬øC√≥mo quieres entrar a partir de ahora?</h1>
      <p class="muted">Puedes activar uno o varios m√©todos.</p>

      <div class="choice-list">
        <button id="choice-pin" class="choice" aria-pressed="false">
          <strong>PIN r√°pido</strong>
          <br><span class="muted tiny">Acceso r√°pido en este dispositivo.</span>
        </button>

        <button id="choice-auto" class="choice" aria-pressed="false">
          <strong>Entrar autom√°ticamente</strong>
          <br><span class="muted tiny">Mantener sesi√≥n en este dispositivo.</span>
        </button>

        <button id="choice-sms" class="choice" aria-pressed="true">
          <strong>SMS como respaldo</strong>
          <br><span class="muted tiny">Para recuperaci√≥n o nuevo dispositivo.</span>
        </button>
      </div>

      <button id="btn-access-save" class="btn btn-primary" style="width:100%; margin-top:1rem;">Guardar
        preferencias</button>
    </div>
  </section>

  <!-- F) Create PIN -->
  <section id="view-create-pin" class="view hidden">
    <div class="card onboarding-card">
      <h1>Crea tu PIN</h1>
      <p class="muted">Este PIN solo funciona en este dispositivo.</p>

      <label class="field">
        <span>PIN</span>
        <input id="pin-1" type="password" inputmode="numeric" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </label>

      <label class="field" style="margin-top:1rem;">
        <span>Confirmar PIN</span>
        <input id="pin-2" type="password" inputmode="numeric" maxlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </label>

      <div class="row" style="margin-top:1.5rem;">
        <button id="btn-pin-back" class="btn btn-secondary">Atr√°s</button>
        <button id="btn-pin-save" class="btn btn-primary">Confirmar PIN</button>
      </div>

      <p id="pin-error" class="tiny error hidden" style="margin-top:0.5rem;"></p>
    </div>
  </section>

  <!-- G) Invite Partner -->
  <section id="view-invite" class="view hidden">
    <div class="card onboarding-card">
      <h1>Invita a tu pareja</h1>
      <p class="muted">Este hogar permite m√°ximo 2 usuarios: owner y partner.</p>

      <div class="invite-box"
        style="background:rgba(0,0,0,0.03); padding:1rem; border-radius:8px; margin:1rem 0; display:flex; gap:10px; align-items:center;">
        <div style="flex:1;">
          <span class="tiny muted" style="display:block;">C√≥digo</span>
          <div id="invite-code" class="code" style="font-weight:bold;">‚Äî</div>
        </div>
        <button id="btn-invite-generate" class="btn btn-primary btn-sm">Generar</button>
        <button id="btn-invite-copy" class="btn btn-secondary btn-sm">Copiar</button>
      </div>

      <div class="row">
        <button id="btn-invite-skip" class="btn btn-secondary">Lo har√© despu√©s</button>
        <button id="btn-invite-finish" class="btn btn-primary">Ir al Dashboard</button>
      </div>

      <p id="invite-hint" class="tiny muted" style="margin-top:0.5rem;"></p>
    </div>
  </section>

  </main>

  <!-- Librer√≠as externas para generaci√≥n de PDF (html2canvas y jsPDF) -->
  <!-- Cargamos primero las librer√≠as de terceros para que est√©n disponibles cuando se ejecute app.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
    integrity="sha512-BNaP9aBhgzWrAXjN0W0mdZShSpEafVFsltL38gdnAyL7I7+dUULUNuOiyBA0jR4cE6OFB49SR1GCRXvVhXXhMw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
    integrity="sha512-HIqbaTT5vZcd5pbOmT44y4AivIMuBJOCa/MEGLjm+rXhN8gGs23Qu4pWAzGn9rprAlXa/5qIwmAeGHw8UAXAuw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- Firebase SDKs (Compat version for easier vanilla JS integration) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <!-- Application script principal -->
  <!-- Cargamos la versi√≥n no minificada para incluir el sistema de sobres y dem√°s funcionalidades actualizadas -->
  <script src="./app.js"></script>
  <!-- Register service worker if available -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('./service-worker.js')
          .catch((err) => console.warn('Service worker registration failed:', err));
      });
    }
  </script>
</body>

</html>